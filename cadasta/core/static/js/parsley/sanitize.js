/***
Adds check to parsley to prevent emojis, html, and script tags.
***/

window.Parsley
  .addValidator('sanitize', function (value, requirement) {
    function isHTMLElement(node) {
      return node.nodeType === 1;
    }

    function isHTML(str) {
        var doc = new DOMParser().parseFromString(str, "text/html");
        var bodyNodes = Array.from(doc.body.childNodes);
        var headNodes = Array.from(doc.head.childNodes);
        return bodyNodes.some(isHTMLElement) || headNodes.some(isHTMLElement);
    }

    var emojis = /.*[\ud83c\udc04|\ud83c\udccf|\ud83c[\udd70-\udd71]|\ud83c\udd7e|\ud83c\udd7f|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\ud83c[\udf00-\udf20]|\ud83c\udf21|\ud83c[\udf24-\udf2c]|\ud83c[\udf2d-\udf2f]|\ud83c[\udf30-\udf35]|\ud83c\udf36|\ud83c[\udf37-\udf7c]|\ud83c\udf7d|\ud83c[\udf7e-\udf7f]|\ud83c[\udf80-\udf93]|\ud83c[\udf96-\udf97]|\ud83c[\udf99-\udf9b]|\ud83c[\udf9e-\udf9f]|\ud83c[\udfa0-\udfc4]|\ud83c\udfc5|\ud83c[\udfc6-\udfca]|\ud83c[\udfcb-\udfce]|\ud83c[\udfcf-\udfd3]|\ud83c[\udfd4-\udfdf]|\ud83c[\udfe0-\udff0]|\ud83c[\udff3-\udff5]|\ud83c\udff7|\ud83c[\udff8-\udfff]|\ud83c\udc04|\ud83c\udccf|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c\ude01|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude36]|\ud83c[\ude38-\ude3a]|\ud83c[\ude50-\ude51]|\ud83c[\udf00-\udf20]|\ud83c[\udf2d-\udf2f]|\ud83c[\udf30-\udf35]|\ud83c[\udf37-\udf7c]|\ud83c[\udf7e-\udf7f]|\ud83c[\udf80-\udf93]|\ud83c[\udfa0-\udfc4]|\ud83c\udfc5|\ud83c[\udfc6-\udfca]|\ud83c[\udfcf-\udfd3]|\ud83c[\udfe0-\udff0]|\ud83c\udff4|\ud83c[\udff8-\udfff]|\ud83c\udf85|\ud83c[\udfc2-\udfc4]|\ud83c\udfc7|\ud83c\udfca|\ud83c[\udfcb-\udfcc]|\ud83c[\udde6-\uddff]|\ud83c[\udffb-\udfff]|\ud83d[\udc42-\udc43]|\ud83d[\udc46-\udc50]|\ud83d[\udc66-\udc69]|\ud83d\udc6e|\ud83d[\udc70-\udc78]|\ud83d\udc7c|\ud83d[\udc81-\udc83]|\ud83d[\udc85-\udc87]|\ud83d\udcaa|\ud83d[\udd74-\udd75]|\ud83d\udd7a|\ud83d\udd90|\ud83d[\udd95-\udd96]|\ud83d[\ude45-\ude47]|\ud83d[\ude4b-\ude4f]|\ud83d\udea3|\ud83d[\udeb4-\udeb6]|\ud83d\udec0|\ud83d\udecc|\ud83d[\udc00-\udc3e]|\ud83d\udc3f|\ud83d\udc40|\ud83d\udc41|\ud83d[\udc42-\udcf7]|\ud83d\udcf8|\ud83d[\udcf9-\udcfc]|\ud83d\udcfd|\ud83d\udcff|\ud83d[\udd00-\udd3d]|\ud83d[\udd49-\udd4a]|\ud83d[\udd4b-\udd4e]|\ud83d[\udd50-\udd67]|\ud83d[\udd6f-\udd70]|\ud83d[\udd73-\udd79]|\ud83d\udd7a|\ud83d\udd87|\ud83d[\udd8a-\udd8d]|\ud83d\udd90|\ud83d[\udd95-\udd96]|\ud83d\udda4|\ud83d\udda5|\ud83d\udda8|\ud83d[\uddb1-\uddb2]|\ud83d\uddbc|\ud83d[\uddc2-\uddc4]|\ud83d[\uddd1-\uddd3]|\ud83d[\udddc-\uddde]|\ud83d\udde1|\ud83d\udde3|\ud83d\udde8|\ud83d\uddef|\ud83d\uddf3|\ud83d\uddfa|\ud83d[\uddfb-\uddff]|\ud83d\ude00|\ud83d[\ude01-\ude10]|\ud83d\ude11|\ud83d[\ude12-\ude14]|\ud83d\ude15|\ud83d\ude16|\ud83d\ude17|\ud83d\ude18|\ud83d\ude19|\ud83d\ude1a|\ud83d\ude1b|\ud83d[\ude1c-\ude1e]|\ud83d\ude1f|\ud83d[\ude20-\ude25]|\ud83d[\ude26-\ude27]|\ud83d[\ude28-\ude2b]|\ud83d\ude2c|\ud83d\ude2d|\ud83d[\ude2e-\ude2f]|\ud83d[\ude30-\ude33]|\ud83d\ude34|\ud83d[\ude35-\ude40]|\ud83d[\ude41-\ude42]|\ud83d[\ude43-\ude44]|\ud83d[\ude45-\ude4f]|\ud83d[\ude80-\udec5]|\ud83d[\udecb-\udecf]|\ud83d\uded0|\ud83d[\uded1-\uded2]|\ud83d[\udee0-\udee5]|\ud83d\udee9|\ud83d[\udeeb-\udeec]|\ud83d\udef0|\ud83d\udef3|\ud83d[\udef4-\udef6]|\ud83d[\udef7-\udef8]|\ud83d[\udc00-\udc3e]|\ud83d\udc40|\ud83d[\udc42-\udcf7]|\ud83d\udcf8|\ud83d[\udcf9-\udcfc]|\ud83d\udcff|\ud83d[\udd00-\udd3d]|\ud83d[\udd4b-\udd4e]|\ud83d[\udd50-\udd67]|\ud83d\udd7a|\ud83d[\udd95-\udd96]|\ud83d\udda4|\ud83d[\uddfb-\uddff]|\ud83d\ude00|\ud83d[\ude01-\ude10]|\ud83d\ude11|\ud83d[\ude12-\ude14]|\ud83d\ude15|\ud83d\ude16|\ud83d\ude17|\ud83d\ude18|\ud83d\ude19|\ud83d\ude1a|\ud83d\ude1b|\ud83d[\ude1c-\ude1e]|\ud83d\ude1f|\ud83d[\ude20-\ude25]|\ud83d[\ude26-\ude27]|\ud83d[\ude28-\ude2b]|\ud83d\ude2c|\ud83d\ude2d|\ud83d[\ude2e-\ude2f]|\ud83d[\ude30-\ude33]|\ud83d\ude34|\ud83d[\ude35-\ude40]|\ud83d[\ude41-\ude42]|\ud83d[\ude43-\ude44]|\ud83d[\ude45-\ude4f]|\ud83d[\ude80-\udec5]|\ud83d\udecc|\ud83d\uded0|\ud83d[\uded1-\uded2]|\ud83d[\udeeb-\udeec]|\ud83d[\udef4-\udef6]|\ud83d[\udef7-\udef8]|\ud83e[\udd10-\udd18]|\ud83e[\udd19-\udd1e]|\ud83e\udd1f|\ud83e[\udd20-\udd27]|\ud83e[\udd28-\udd2f]|\ud83e\udd30|\ud83e[\udd31-\udd32]|\ud83e[\udd33-\udd3a]|\ud83e[\udd3c-\udd3e]|\ud83e[\udd40-\udd45]|\ud83e[\udd47-\udd4b]|\ud83e\udd4c|\ud83e[\udd50-\udd5e]|\ud83e[\udd5f-\udd6b]|\ud83e[\udd80-\udd84]|\ud83e[\udd85-\udd91]|\ud83e[\udd92-\udd97]|\ud83e\uddc0|\ud83e[\uddd0-\udde6]|\ud83e[\udd10-\udd18]|\ud83e[\udd19-\udd1e]|\ud83e\udd1f|\ud83e[\udd20-\udd27]|\ud83e[\udd28-\udd2f]|\ud83e\udd30|\ud83e[\udd31-\udd32]|\ud83e[\udd33-\udd3a]|\ud83e[\udd3c-\udd3e]|\ud83e[\udd40-\udd45]|\ud83e[\udd47-\udd4b]|\ud83e\udd4c|\ud83e[\udd50-\udd5e]|\ud83e[\udd5f-\udd6b]|\ud83e[\udd80-\udd84]|\ud83e[\udd85-\udd91]|\ud83e[\udd92-\udd97]|\ud83e\uddc0|\ud83e[\uddd0-\udde6]|\ud83e\udd18|\ud83e[\udd19-\udd1c]|\ud83e\udd1e|\ud83e\udd1f|\ud83e\udd26|\ud83e\udd30|\ud83e[\udd31-\udd32]|\ud83e[\udd33-\udd39]|\ud83e[\udd3d-\udd3e]|\ud83e[\uddd1-\udddd]|\u00A9|\u00AE|\u203C|\u2049|\u2122|\u2139|\u2194-\u2199|\u21A9-\u21AA|\u231A-\u231B|\u2328|\u23CF|\u23E9-\u23F3|\u23F8-\u23FA|\u24C2|\u25AA-\u25AB|\u25B6|\u25C0|\u25FB-\u25FE|\u2600-\u2604|\u260E|\u2611|\u2614-\u2615|\u2618|\u261D|\u2620|\u2622-\u2623|\u2626|\u262A|\u262E-\u262F|\u2638-\u263A|\u2640|\u2642|\u2648-\u2653|\u2660|\u2663|\u2665-\u2666|\u2668|\u267B|\u267F|\u2692-\u2697|\u2699|\u269B-\u269C|\u26A0-\u26A1|\u26AA-\u26AB|\u26B0-\u26B1|\u26BD-\u26BE|\u26C4-\u26C5|\u26C8|\u26CE|\u26CF|\u26D1|\u26D3-\u26D4|\u26E9-\u26EA|\u26F0-\u26F5|\u26F7-\u26FA|\u26FD|\u2702|\u2705|\u2708-\u2709|\u270A-\u270B|\u270C-\u270D|\u270F|\u2712|\u2714|\u2716|\u271D|\u2721|\u2728|\u2733-\u2734|\u2744|\u2747|\u274C|\u274E|\u2753-\u2755|\u2757|\u2763-\u2764|\u2795-\u2797|\u27A1|\u27B0|\u27BF|\u2934-\u2935|\u2B05-\u2B07|\u2B1B-\u2B1C|\u2B50|\u2B55|\u3030|\u303D|\u3297|\u3299|\u231A-\u231B|\u23E9-\u23EC|\u23F0|\u23F3|\u25FD-\u25FE|\u2614-\u2615|\u2648-\u2653|\u267F|\u2693|\u26A1|\u26AA-\u26AB|\u26BD-\u26BE|\u26C4-\u26C5|\u26CE|\u26D4|\u26EA|\u26F2-\u26F3|\u26F5|\u26FA|\u26FD|\u2705|\u270A-\u270B|\u2728|\u274C|\u274E|\u2753-\u2755|\u2757|\u2795-\u2797|\u27B0|\u27BF|\u2B1B-\u2B1C|\u2B50|\u2B55|\u261D|\u26F9|\u270A-\u270B|\u270C-\u270D].*/;
    var macros = /^[-=+@]/;
    return !value.match(emojis) && !value.match(macros) && !isHTML(value);
  }, 2)
  .addMessage('sanitize', gettext('Input can not contain HTML tags, emojis or start with any of + - = and @.'));
