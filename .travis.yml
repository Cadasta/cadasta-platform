sudo: required
dist: trusty
group: deprecated-2017Q2
language: python
python:
  - '3.5'
addons:
  postgresql: '9.4'
  apt:
    packages:
      - postgresql-9.4-postgis-2.3

before_install:
  - export DEBIAN_FRONTEND=noninteractive
  - sudo -E apt-get -yq update &>> ~/apt-get-update.log
  - sudo -E apt-get -yq --no-install-suggests --no-install-recommends --force-yes install squid3
  - sudo apt-get -yq install libgdal-dev
  - gdal-config --version
  - export PATH=$(echo $PATH | tr ':' "\n" | sed '/\/opt\/python/d' | tr "\n" ":" | sed "s|::|:|g")
  - export C_INCLUDE_PATH=/usr/include/gdal
  - export CPLUS_INCLUDE_PATH=/usr/include/gdal

install:
  - pip install tox==2.3.1

before_script:
  - sudo cp provision/roles/testing/files/squid.conf /etc/squid3/squid.conf
  - sudo service squid3 restart
  - export http_proxy=http://localhost:3128/
  - export https_proxy=https://localhost:3128/
  - export DJANGO_SETTINGS_MODULE=config.settings.travis
  - psql template1 postgres -c 'create extension hstore;'
  - psql -c 'create database cadasta;' -U postgres
  - psql -U postgres -d cadasta -c "create extension postgis;"
  - mkdir cadasta/geography/data
  - export WBDATA=ne_10m_admin_0_countries.zip
  - export DATADIR=cadasta/geography/data
  - wget -O $DATADIR/$WBDATA https://cadasta-miscellaneous.s3.amazonaws.com/$WBDATA
  - unzip $DATADIR/$WBDATA -d $DATADIR

env:
  global:
    - secure: bHitijj3QQGevw88b1OdkqWJzuADpQkqM2Jrr3iD/HC5E3Jh9JtoJkfBE8iemfTfbuiGjCPDKJA8ZFNs1/8yyuLbukohpBnGZ3EVNfkhZEoECMIbd6E7EGcQoosNtJi6Z7MBWj2hvzpsJqGdAXmj6aC91hKP6kLSa2ponruEsQWNljmxkCVLymOQZhsi5FHzQflAzEtCEzWzSr1g7EznxeZMqARMYJJe0bM4zue1nNkVUqlrwoZEQ+PKu9DwYJCJ32HdcKknlOLjiORtpaudiuSTE/H1HugqEteAyzgt6ugpKaD90e1INKffOCZou24RyGkkn6ndhi7eehGhxCE0ZW8TKpWSkjHLBR2wjGZlRyW0Zu+rsHH1Y5NsnRUHiGXX9WlFJJa6eiV7X9jjQiDo2zx8KFshPlOyGIHBOcjwlcOrCLdCLJbJvMQQP8kF0z8SjgLgerxg2DYqGm04RQSeNxGPY0t5zvsKKz3FUsnbMC/xB3y7kCrS92iuCcQagvI/KWzSG09vhtO0BiEuhgpX/R7LVDRgGtFpIcNliWPYhCocbtWu/8WG7e4up3dOMpHsM2bimGrgtx3QVwCmQ8dKxiGuRV6W2WZluhVmygvUyMctlK5m9tDrbDDbxaRvsIMz/iGRMnV+fJ9BHGo4QInu6HYzMhLMFsT26DuSvqlZROI=
    - secure: EGMobaU7AzPFxOySQSTU8IdKKykRoEZBJJ+MXE8pDcgRJ31XlaekspexbDSCzNrQ64lpeYpfUSwunHSNDykVPBiPJAvMEGumsGguEm4dmZUIPWAGDHCdd2bEZAVgdX5rThcHlYhifza4H9mB8cQNi1VmY+svUT41lJdvGqVDP4waoI1jcdJ1mtKYaIdlL/2tcXfpOzBGggBzeocDbdgKyO5KwhEcQxv8qcr0hF0kURZG40C3U1Nm6p58U0J3RoEJ+kePwVyYBJD2MUNpCvMbVuh+yuWncGjEQQE5l2k4QBvChHguc0OCEX6zILikZ69vrdrAvaMfxX2argcb8YaLCHw6NKTaNFqunUaH7FO41j//YPToYq+u8GFA+cJsi/O/7KEP7tFGb+uikZSqAaTGuPfU/4m39xtGNziucFezRNt/p/2GSOin9VWUhb1LPmMwwg6wK7ZtN2Vf8MnUgXqKBCuHaXVohlPN5FqUAziHjGgT0jxoyR2PZZ3bW/sjLieQzQtweln5WkccMaZLbJCD5ZNKgw2RdmfEaV5Hn1eAdjoe1ykUvKmKSJpj7deYcWfrILrZtqqWfuzQfhPIMsrWx6AW9KLO+9AvTxAnnc3Zw4iJSOeozcEacAos2MrJ2tAVB+LfnAEl9ooXvwuvGL/F4fmc6QBDQD4v2Pb9kBgpZ/M=
  matrix:
    - TOX_ENV=py35-flake8
    - TOX_ENV=py35-django1.9-migration
    - TOX_ENV=py35-django1.9-unit

matrix:
  fast_finish: true

script:
  - tox -e $TOX_ENV

notifications:
  slack:
    on_success: always
    on_failure: change
    secure: feHcuDtPoJ6M8C9wpQAu2nnuI98OhMZJLcPu/IgXC2GeFXHPybRzKdLvZJkDCxJZWCwqEt0DsJG/wk/Yh/jYQ/rORT6I5lYab6DvnFULl1c4C5tl7wdCEnXdwKUi3D1jxbN/FDa00GT0LEtNHaF9C08cgvalZ0WgQmVzw5gjnU7WTqqjSPVmP8Tf8Lknqwpy+v3SC5uRGn4/pr3sydfyUwg8b6DIvkKdNUDf5FsjBhjMpFcT2WERc+e34KkMMhY3/XhRW6fGjFzrkP+qyZj0Xr9B+Uuk4rzxzdwIS+E3BJ8HiPbP8AFzSVOm08YeA7cj/mleR9bY85dWH+qzmwXLhF6p7MyeRyFT2zxEajq/3PdNyi4c6im1zNFOKs+vchEQpqD0OWg2CBGeMPX9zBAgurdc6feLL6bazVzjm/Q+Xlob0QXgxWIOwhPDcGpGMbFdEonZN1POrBGQhZpXCUDVZsV9EwTmT8mNMRczsccIHlF8OxnTnMIaqIzOs2xs/TIqOz/PWIXP6R2eZEvNyY5KGFz/Eb1AJ5ayUy6bdQJeL+UTq7W376XKcP0BkSzBWaAYm1fTBtKAeiJ3owQg+z2UiagIM1EMiQBXp2NSMFqAZHUOXl0POr6K+cj9Iys/6WkBd5FvjZw63GpgY7urin6H7jfsqv1Qq28JmXD4HxfvKSY=
